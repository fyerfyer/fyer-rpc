"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[624],{7567:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>s,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"user-guide/client/client","title":"Client","description":"\u5ba2\u6237\u7aef\u662ffyerrpc\u6846\u67b6\u7684\u6838\u5fc3\u7ec4\u4ef6\u4e4b\u4e00\uff0c\u8d1f\u8d23\u5411\u670d\u52a1\u7aef\u53d1\u8d77RPC\u8bf7\u6c42\u5e76\u5904\u7406\u54cd\u5e94\u3002","source":"@site/docs/user-guide/client/client.md","sourceDirName":"user-guide/client","slug":"/user-guide/client/","permalink":"/fyer-rpc/docs/user-guide/client/","draft":false,"unlisted":false,"editUrl":"https://github.com/fyerfyer/fyer-rpc/tree/main/docs/user-guide/client/client.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Protocol","permalink":"/fyer-rpc/docs/protocol/protocol-intro"},"next":{"title":"Serilization","permalink":"/fyer-rpc/docs/user-guide/serilization/"}}');var l=r(4848),t=r(8453);const o={},c="Client",s={},a=[{value:"\u57fa\u7840\u5ba2\u6237\u7aef",id:"\u57fa\u7840\u5ba2\u6237\u7aef",level:2},{value:"Client\u63a5\u53e3",id:"client\u63a5\u53e3",level:3},{value:"\u521b\u5efa\u5ba2\u6237\u7aef\u5b9e\u4f8b",id:"\u521b\u5efa\u5ba2\u6237\u7aef\u5b9e\u4f8b",level:3},{value:"\u8c03\u7528\u8fdc\u7a0b\u670d\u52a1",id:"\u8c03\u7528\u8fdc\u7a0b\u670d\u52a1",level:3},{value:"\u5e95\u5c42\u5ba2\u6237\u7aef\u5b9e\u73b0",id:"\u5e95\u5c42\u5ba2\u6237\u7aef\u5b9e\u73b0",level:2},{value:"\u521b\u5efa\u5e95\u5c42\u5ba2\u6237\u7aef",id:"\u521b\u5efa\u5e95\u5c42\u5ba2\u6237\u7aef",level:3},{value:"\u5e95\u5c42\u8c03\u7528\u65b9\u6cd5",id:"\u5e95\u5c42\u8c03\u7528\u65b9\u6cd5",level:3},{value:"\u5ba2\u6237\u7aef\u914d\u7f6e",id:"\u5ba2\u6237\u7aef\u914d\u7f6e",level:2},{value:"ClientConfig",id:"clientconfig",level:3},{value:"\u9ed8\u8ba4\u914d\u7f6e",id:"\u9ed8\u8ba4\u914d\u7f6e",level:3},{value:"\u914d\u7f6e\u9009\u9879\u51fd\u6570",id:"\u914d\u7f6e\u9009\u9879\u51fd\u6570",level:3},{value:"\u8fde\u63a5\u6c60",id:"\u8fde\u63a5\u6c60",level:2},{value:"ConnPool",id:"connpool",level:3},{value:"\u521b\u5efa\u8fde\u63a5\u6c60",id:"\u521b\u5efa\u8fde\u63a5\u6c60",level:3},{value:"\u4f7f\u7528\u8fde\u63a5\u6c60",id:"\u4f7f\u7528\u8fde\u63a5\u6c60",level:3},{value:"\u52a8\u6001\u4ee3\u7406",id:"\u52a8\u6001\u4ee3\u7406",level:2},{value:"\u521b\u5efa\u4ee3\u7406",id:"\u521b\u5efa\u4ee3\u7406",level:3},{value:"\u4f7f\u7528\u4ee3\u7406\u8c03\u7528",id:"\u4f7f\u7528\u4ee3\u7406\u8c03\u7528",level:3},{value:"\u9ad8\u7ea7\u4ee3\u7406\u914d\u7f6e",id:"\u9ad8\u7ea7\u4ee3\u7406\u914d\u7f6e",level:3},{value:"\u4ee3\u7406\u5de5\u4f5c\u539f\u7406",id:"\u4ee3\u7406\u5de5\u4f5c\u539f\u7406",level:3},{value:"\u793a\u4f8b\u4ee3\u7801",id:"\u793a\u4f8b\u4ee3\u7801",level:2},{value:"API\u5ba2\u6237\u7aef\u793a\u4f8b",id:"api\u5ba2\u6237\u7aef\u793a\u4f8b",level:3},{value:"\u4ee3\u7406\u8c03\u7528\u793a\u4f8b",id:"\u4ee3\u7406\u8c03\u7528\u793a\u4f8b",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"client",children:"Client"})}),"\n",(0,l.jsx)(n.p,{children:"\u5ba2\u6237\u7aef\u662ffyerrpc\u6846\u67b6\u7684\u6838\u5fc3\u7ec4\u4ef6\u4e4b\u4e00\uff0c\u8d1f\u8d23\u5411\u670d\u52a1\u7aef\u53d1\u8d77RPC\u8bf7\u6c42\u5e76\u5904\u7406\u54cd\u5e94\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"\u57fa\u7840\u5ba2\u6237\u7aef",children:"\u57fa\u7840\u5ba2\u6237\u7aef"}),"\n",(0,l.jsx)(n.h3,{id:"client\u63a5\u53e3",children:"Client\u63a5\u53e3"}),"\n",(0,l.jsxs)(n.p,{children:["fyerrpc\u6846\u67b6\u901a\u8fc7",(0,l.jsx)(n.code,{children:"api.Client"}),"\u63a5\u53e3\u5b9a\u4e49\u4e86\u5ba2\u6237\u7aef\u7684\u57fa\u672c\u884c\u4e3a\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:"type Client interface {\r\n    // Call \u540c\u6b65\u8c03\u7528\u8fdc\u7a0b\u670d\u52a1\r\n    Call(ctx context.Context, service, method string, req interface{}, resp interface{}) error\r\n\r\n    // Close \u5173\u95ed\u5ba2\u6237\u7aef\u8fde\u63a5\r\n    Close() error\r\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u521b\u5efa\u5ba2\u6237\u7aef\u5b9e\u4f8b",children:"\u521b\u5efa\u5ba2\u6237\u7aef\u5b9e\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'import "github.com/fyerfyer/fyer-rpc/api"\r\n\r\n// \u521b\u5efa\u5ba2\u6237\u7aef\u914d\u7f6e\r\noptions := &api.ClientOptions{\r\n    Address:       "localhost:8000",               // \u670d\u52a1\u5668\u5730\u5740\r\n    Timeout:       time.Second * 5,                // \u8bf7\u6c42\u8d85\u65f6\r\n    SerializeType: protocol.SerializationTypeJSON, // \u4f7f\u7528JSON\u5e8f\u5217\u5316\r\n}\r\n\r\n// \u521b\u5efa\u5ba2\u6237\u7aef\r\nclient, err := api.NewClient(options)\r\nif err != nil {\r\n    log.Fatalf("Failed to create client: %v", err)\r\n}\r\ndefer client.Close()\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u5982\u679c\u4e0d\u63d0\u4f9b\u914d\u7f6e\u9879\uff0c\u5ba2\u6237\u7aef\u5c06\u4f7f\u7528\u9ed8\u8ba4\u914d\u7f6e\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'// \u4f7f\u7528\u9ed8\u8ba4\u914d\u7f6e\u521b\u5efa\u5ba2\u6237\u7aef\r\nclient, err := api.NewClient(&api.ClientOptions{\r\n    Address: "localhost:8000",  // \u5730\u5740\u662f\u5fc5\u987b\u63d0\u4f9b\u7684\r\n})\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u8c03\u7528\u8fdc\u7a0b\u670d\u52a1",children:"\u8c03\u7528\u8fdc\u7a0b\u670d\u52a1"}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u7528\u5ba2\u6237\u7aef\u8c03\u7528\u8fdc\u7a0b\u670d\u52a1\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'// \u5b9a\u4e49\u8bf7\u6c42\u548c\u54cd\u5e94\u7ed3\u6784\u4f53\r\ntype HelloRequest struct {\r\n    Name string `json:"name"`\r\n}\r\n\r\ntype HelloResponse struct {\r\n    Message string `json:"message"`\r\n}\r\n\r\n// \u521b\u5efa\u8bf7\u6c42\u5bf9\u8c61\r\nrequest := &HelloRequest{Name: "World"}\r\n\r\n// \u521b\u5efa\u54cd\u5e94\u5bf9\u8c61\r\nresponse := &HelloResponse{}\r\n\r\n// \u8c03\u7528\u8fdc\u7a0b\u670d\u52a1\r\nctx, cancel := context.WithTimeout(context.Background(), time.Second*3)\r\ndefer cancel()\r\n\r\nerr = client.Call(ctx, "GreeterService", "SayHello", request, response)\r\nif err != nil {\r\n    log.Fatalf("RPC call failed: %v", err)\r\n}\r\n\r\nfmt.Printf("Response: %s\\n", response.Message)\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u5e95\u5c42\u5ba2\u6237\u7aef\u5b9e\u73b0",children:"\u5e95\u5c42\u5ba2\u6237\u7aef\u5b9e\u73b0"}),"\n",(0,l.jsxs)(n.p,{children:["\u9664\u4e86\u9ad8\u7ea7\u7684",(0,l.jsx)(n.code,{children:"api.Client"}),"\u63a5\u53e3\uff0cfyerrpc\u8fd8\u63d0\u4f9b\u4e86\u66f4\u5e95\u5c42\u7684",(0,l.jsx)(n.code,{children:"rpc.Client"}),"\u5b9e\u73b0\uff0c\u4e3a\u9700\u8981\u66f4\u591a\u63a7\u5236\u548c\u5b9a\u5236\u7684\u573a\u666f\u63d0\u4f9b\u652f\u6301\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"\u521b\u5efa\u5e95\u5c42\u5ba2\u6237\u7aef",children:"\u521b\u5efa\u5e95\u5c42\u5ba2\u6237\u7aef"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'import "github.com/fyerfyer/fyer-rpc/rpc"\r\n\r\n// \u521b\u5efa\u5ba2\u6237\u7aef\r\nclient, err := rpc.NewClient("localhost:8000")\r\nif err != nil {\r\n    log.Fatalf("Failed to create client: %v", err)\r\n}\r\ndefer client.Close()\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u5e95\u5c42\u5ba2\u6237\u7aef\u652f\u6301\u901a\u8fc7\u9009\u9879\u6a21\u5f0f\u914d\u7f6e\u9ad8\u7ea7\u529f\u80fd\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'// \u521b\u5efa\u5e26\u6545\u969c\u8f6c\u79fb\u529f\u80fd\u7684\u5ba2\u6237\u7aef\r\nconfig := &failover.Config{\r\n    MaxAttempts:      3,\r\n    RetryInterval:    time.Millisecond * 100,\r\n    RetryableErrors:  []string{"connection refused", "timeout"},\r\n    FailureThreshold: 5,\r\n    SuccessThreshold: 2,\r\n    ResetInterval:    time.Minute,\r\n}\r\n\r\nclient, err := rpc.NewClient("localhost:8000", \r\n    rpc.WithFailover(config),\r\n)\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u5e95\u5c42\u8c03\u7528\u65b9\u6cd5",children:"\u5e95\u5c42\u8c03\u7528\u65b9\u6cd5"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"rpc.Client"}),"\u63d0\u4f9b\u4e86\u4ee5\u4e0b\u8c03\u7528\u65b9\u6cd5\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:"// \u57fa\u672cRPC\u8c03\u7528\r\nfunc (c *Client) Call(serviceName, methodName string, args interface{}) ([]byte, error)\r\n\r\n// \u5e26\u8d85\u65f6\u7684RPC\u8c03\u7528\r\nfunc (c *Client) CallWithTimeout(ctx context.Context, serviceName, methodName string, args interface{}) ([]byte, error)\r\n\r\n// \u5e26\u6545\u969c\u8f6c\u79fb\u7684RPC\u8c03\u7528\r\nfunc (c *Client) CallWithFailover(ctx context.Context, serviceName, methodName string, args interface{}, instances []*naming.Instance) ([]byte, error)\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5e95\u5c42\u8c03\u7528\u793a\u4f8b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'// \u521b\u5efa\u8bf7\u6c42\u5bf9\u8c61\r\nrequest := &HelloRequest{Name: "World"}\r\n\r\n// \u5e8f\u5217\u5316\u8bf7\u6c42\u53c2\u6570\uff08\u5e95\u5c42\u5ba2\u6237\u7aef\u4e0d\u4f1a\u81ea\u52a8\u5e8f\u5217\u5316\uff09\r\nserializer := codec.GetCodec(codec.JSON)\r\nreqBytes, err := serializer.Encode(request)\r\nif err != nil {\r\n    log.Fatalf("Failed to encode request: %v", err)\r\n}\r\n\r\n// \u5e26\u8d85\u65f6\u7684RPC\u8c03\u7528\r\nctx, cancel := context.WithTimeout(context.Background(), time.Second*3)\r\ndefer cancel()\r\n\r\nrespBytes, err := client.CallWithTimeout(ctx, "GreeterService", "SayHello", request)\r\nif err != nil {\r\n    log.Fatalf("RPC call failed: %v", err)\r\n}\r\n\r\n// \u624b\u52a8\u89e3\u6790\u54cd\u5e94\r\nresponse := &HelloResponse{}\r\nerr = serializer.Decode(respBytes, response)\r\nif err != nil {\r\n    log.Fatalf("Failed to decode response: %v", err)\r\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u5ba2\u6237\u7aef\u914d\u7f6e",children:"\u5ba2\u6237\u7aef\u914d\u7f6e"}),"\n",(0,l.jsxs)(n.p,{children:["fyerrpc\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u5ba2\u6237\u7aef\u914d\u7f6e\u9009\u9879\uff0c\u901a\u8fc7",(0,l.jsx)(n.code,{children:"config.ClientConfig"}),"\u8fdb\u884c\u8bbe\u7f6e\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"clientconfig",children:"ClientConfig"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"config.ClientConfig"}),"\u5305\u542b\u4e86\u8be6\u7ec6\u7684\u5ba2\u6237\u7aef\u914d\u7f6e\u9879\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:"type ClientConfig struct {\r\n    *CommonConfig // \u7ee7\u627f\u901a\u7528\u914d\u7f6e\r\n\r\n    // \u8fde\u63a5\u76f8\u5173\u914d\u7f6e\r\n    PoolSize        int           // \u8fde\u63a5\u6c60\u5927\u5c0f\r\n    MaxIdle         int           // \u6700\u5927\u7a7a\u95f2\u8fde\u63a5\u6570\r\n    IdleTimeout     time.Duration // \u7a7a\u95f2\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\r\n    KeepAlive       bool          // \u662f\u5426\u4fdd\u6301\u8fde\u63a5\u6d3b\u8dc3\r\n    KeepAliveTime   time.Duration // \u8fde\u63a5\u4fdd\u6d3b\u65f6\u95f4\r\n    KeepAliveCount  int           // \u4fdd\u6d3b\u63a2\u6d4b\u6b21\u6570\r\n    KeepAliveIdle   time.Duration // \u8fde\u63a5\u7a7a\u95f2\u591a\u4e45\u5f00\u59cb\u4fdd\u6d3b\u63a2\u6d4b\r\n    ConnectionLimit int           // \u5355\u4e2a\u5730\u5740\u6700\u5927\u8fde\u63a5\u6570\r\n\r\n    // \u8d1f\u8f7d\u5747\u8861\u76f8\u5173\u914d\u7f6e\r\n    LoadBalanceType    balancer.BalancerType // \u8d1f\u8f7d\u5747\u8861\u7c7b\u578b\r\n    UpdateInterval     time.Duration         // \u670d\u52a1\u53d1\u73b0\u66f4\u65b0\u95f4\u9694\r\n    EnableConsistentLB bool                  // \u662f\u5426\u542f\u7528\u4e00\u81f4\u6027\u8d1f\u8f7d\u5747\u8861\r\n\r\n    // \u6545\u969c\u8f6c\u79fb\u914d\u7f6e\r\n    EnableFailover  bool             // \u662f\u5426\u542f\u7528\u6545\u969c\u8f6c\u79fb\r\n    FailoverConfig  *failover.Config // \u6545\u969c\u8f6c\u79fb\u914d\u7f6e\r\n    FailoverTimeout time.Duration    // \u6545\u969c\u8f6c\u79fb\u8d85\u65f6\u65f6\u95f4\r\n\r\n    // \u9650\u6d41\u76f8\u5173\u914d\u7f6e\r\n    MaxConcurrentRequests int           // \u6700\u5927\u5e76\u53d1\u8bf7\u6c42\u6570\r\n    MaxQPS                int           // \u6bcf\u79d2\u6700\u5927\u8bf7\u6c42\u6570\r\n    RequestTimeout        time.Duration // \u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4\r\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u9ed8\u8ba4\u914d\u7f6e",children:"\u9ed8\u8ba4\u914d\u7f6e"}),"\n",(0,l.jsx)(n.p,{children:"fyerrpc\u4e3aClientConfig\u63d0\u4f9b\u4e86\u5408\u7406\u7684\u9ed8\u8ba4\u503c\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:"var DefaultClientConfig = &ClientConfig{\r\n    CommonConfig: DefaultCommonConfig,\r\n\r\n    // \u8fde\u63a5\u76f8\u5173\u9ed8\u8ba4\u914d\u7f6e\r\n    PoolSize:        10,\r\n    MaxIdle:         5,\r\n    IdleTimeout:     time.Minute * 5,\r\n    KeepAlive:       true,\r\n    KeepAliveTime:   time.Second * 30,\r\n    KeepAliveCount:  3,\r\n    KeepAliveIdle:   time.Second * 60,\r\n    ConnectionLimit: 100,\r\n\r\n    // \u8d1f\u8f7d\u5747\u8861\u76f8\u5173\u9ed8\u8ba4\u914d\u7f6e\r\n    LoadBalanceType:    balancer.Random,\r\n    UpdateInterval:     time.Second * 10,\r\n    EnableConsistentLB: false,\r\n\r\n    // \u6545\u969c\u8f6c\u79fb\u9ed8\u8ba4\u914d\u7f6e\r\n    EnableFailover:  true,\r\n    FailoverConfig:  failover.DefaultConfig,\r\n    FailoverTimeout: time.Second * 10,\r\n\r\n    // \u9650\u6d41\u76f8\u5173\u9ed8\u8ba4\u914d\u7f6e\r\n    MaxConcurrentRequests: 100,\r\n    MaxQPS:                1000,\r\n    RequestTimeout:        time.Second * 5,\r\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u914d\u7f6e\u9009\u9879\u51fd\u6570",children:"\u914d\u7f6e\u9009\u9879\u51fd\u6570"}),"\n",(0,l.jsx)(n.p,{children:"fyerrpc\u91c7\u7528\u9009\u9879\u6a21\u5f0f\uff0c\u901a\u8fc7\u51fd\u6570\u94fe\u5f0f\u8c03\u7528\u8fdb\u884c\u914d\u7f6e\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'// \u521b\u5efa\u5ba2\u6237\u7aef\u914d\u7f6e\r\nconfig := config.NewClientConfig(\r\n    // \u8bbe\u7f6e\u8fde\u63a5\u6c60\u914d\u7f6e\r\n    config.WithPoolConfig(20, 10, time.Minute*10),\r\n    \r\n    // \u8bbe\u7f6e\u8fde\u63a5\u4fdd\u6d3b\u914d\u7f6e\r\n    config.WithKeepAlive(true, time.Second*60, time.Minute*2, 5),\r\n    \r\n    // \u8bbe\u7f6e\u8d1f\u8f7d\u5747\u8861\u914d\u7f6e\r\n    config.WithLoadBalancer(balancer.RoundRobin, time.Second*15, false),\r\n    \r\n    // \u8bbe\u7f6e\u6545\u969c\u8f6c\u79fb\u914d\u7f6e\r\n    config.WithFailover(true, failover.DefaultConfig, time.Second*15),\r\n    \r\n    // \u8bbe\u7f6e\u9650\u6d41\u914d\u7f6e\r\n    config.WithRateLimit(200, 2000, time.Second*10),\r\n)\r\n\r\n// \u5e94\u7528\u901a\u7528\u914d\u7f6e\r\nconfig.Apply(\r\n    config.WithSerialization(config.SerializationJSON),\r\n    config.WithTimeouts(time.Second*3, time.Second*10),\r\n    config.WithRetry(3, time.Millisecond*200, []string{"connection_refused", "timeout"}),\r\n)\r\n\r\n// \u521d\u59cb\u5316\u914d\u7f6e\r\nconfig.Init()\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u8fde\u63a5\u6c60",children:"\u8fde\u63a5\u6c60"}),"\n",(0,l.jsx)(n.p,{children:"fyerrpc\u5ba2\u6237\u7aef\u652f\u6301\u8fde\u63a5\u6c60\u7ba1\u7406\uff0c\u6709\u6548\u63d0\u9ad8\u4e86\u8d44\u6e90\u5229\u7528\u7387\u548c\u6027\u80fd\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"connpool",children:"ConnPool"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"rpc.ConnPool"}),"\u7c7b\u5b9e\u73b0\u4e86\u8fde\u63a5\u6c60\u529f\u80fd\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:"type ConnPool struct {\r\n    mu          sync.Mutex\r\n    address     string\r\n    maxIdle     int\r\n    idleTimeout time.Duration\r\n    conns       chan *Client\r\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u521b\u5efa\u8fde\u63a5\u6c60",children:"\u521b\u5efa\u8fde\u63a5\u6c60"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'// \u521b\u5efa\u8fde\u63a5\u6c60\r\npool := rpc.NewConnPool(\r\n    "localhost:8000",  // \u670d\u52a1\u5668\u5730\u5740\r\n    10,               // \u6700\u5927\u7a7a\u95f2\u8fde\u63a5\u6570\r\n    time.Minute*5,    // \u7a7a\u95f2\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\r\n)\r\ndefer pool.Close()\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u4f7f\u7528\u8fde\u63a5\u6c60",children:"\u4f7f\u7528\u8fde\u63a5\u6c60"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'// \u4ece\u8fde\u63a5\u6c60\u83b7\u53d6\u8fde\u63a5\r\nclient, err := pool.Get()\r\nif err != nil {\r\n    log.Fatalf("Failed to get client from pool: %v", err)\r\n}\r\n\r\n// \u4f7f\u7528\u5ba2\u6237\u7aef...\r\nrespBytes, err := client.Call("GreeterService", "SayHello", request)\r\n\r\n// \u5f52\u8fd8\u8fde\u63a5\u5230\u6c60\u4e2d\r\npool.Put(client)\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u8fde\u63a5\u6c60\u5de5\u4f5c\u6d41\u7a0b\uff1a"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u5f53\u8c03\u7528",(0,l.jsx)(n.code,{children:"Get()"}),"\u65f6\uff0c\u5982\u679c\u6c60\u4e2d\u6709\u53ef\u7528\u8fde\u63a5\uff0c\u8fd4\u56de\u4e00\u4e2a\u5df2\u6709\u7684\u8fde\u63a5"]}),"\n",(0,l.jsx)(n.li,{children:"\u5982\u679c\u6c60\u4e3a\u7a7a\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8fde\u63a5"}),"\n",(0,l.jsxs)(n.li,{children:["\u5f53\u8c03\u7528",(0,l.jsx)(n.code,{children:"Put(client)"}),"\u65f6\uff0c\u5982\u679c\u6c60\u672a\u6ee1\uff0c\u8fde\u63a5\u4f1a\u88ab\u653e\u56de\u6c60\u4e2d\u4f9b\u540e\u7eed\u4f7f\u7528"]}),"\n",(0,l.jsx)(n.li,{children:"\u5982\u679c\u6c60\u5df2\u6ee1\uff0c\u8fde\u63a5\u4f1a\u88ab\u76f4\u63a5\u5173\u95ed"}),"\n",(0,l.jsx)(n.li,{children:"\u5f53\u6c60\u5173\u95ed\u65f6\uff0c\u6240\u6709\u6c60\u4e2d\u8fde\u63a5\u4f1a\u88ab\u5173\u95ed\u91ca\u653e"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u52a8\u6001\u4ee3\u7406",children:"\u52a8\u6001\u4ee3\u7406"}),"\n",(0,l.jsx)(n.p,{children:"fyerrpc\u63d0\u4f9b\u4e86\u52a8\u6001\u4ee3\u7406\u529f\u80fd\uff0c\u8ba9\u5f00\u53d1\u8005\u53ef\u4ee5\u50cf\u8c03\u7528\u672c\u5730\u65b9\u6cd5\u4e00\u6837\u8c03\u7528\u8fdc\u7a0b\u670d\u52a1\uff0c\u4e0d\u9700\u8981\u624b\u52a8\u5904\u7406\u5e8f\u5217\u5316\u548c\u7f51\u7edc\u901a\u4fe1\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"\u521b\u5efa\u4ee3\u7406",children:"\u521b\u5efa\u4ee3\u7406"}),"\n",(0,l.jsxs)(n.p,{children:["\u4f7f\u7528",(0,l.jsx)(n.code,{children:"rpc.InitProxy"}),"\u521b\u5efa\u4ee3\u7406\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'// \u5b9a\u4e49\u670d\u52a1\u63a5\u53e3\r\ntype UserService struct {\r\n    GetById func(ctx context.Context, req *GetByIdReq) (*GetByIdResp, error)\r\n    List    func(ctx context.Context, req *ListReq) (*ListResp, error)\r\n}\r\n\r\n// \u521b\u5efa\u4ee3\u7406\r\nvar userService UserService\r\nerr := rpc.InitProxy("localhost:8000", &userService)\r\nif err != nil {\r\n    log.Fatalf("Failed to init proxy: %v", err)\r\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u4f7f\u7528\u4ee3\u7406\u8c03\u7528",children:"\u4f7f\u7528\u4ee3\u7406\u8c03\u7528"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'// \u50cf\u8c03\u7528\u672c\u5730\u65b9\u6cd5\u4e00\u6837\u8c03\u7528\u8fdc\u7a0b\u670d\u52a1\r\nctx := context.Background()\r\nresp, err := userService.GetById(ctx, &GetByIdReq{Id: 123})\r\nif err != nil {\r\n    log.Fatalf("RPC call failed: %v", err)\r\n}\r\nfmt.Printf("User: %v\\n", resp.User)\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u9ad8\u7ea7\u4ee3\u7406\u914d\u7f6e",children:"\u9ad8\u7ea7\u4ee3\u7406\u914d\u7f6e"}),"\n",(0,l.jsx)(n.p,{children:"\u4ee3\u7406\u652f\u6301\u591a\u79cd\u9ad8\u7ea7\u914d\u7f6e\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'// \u521b\u5efa\u5e26\u8d1f\u8f7d\u5747\u8861\u7684\u4ee3\u7406\r\ndiscoveryClient, _ := discovery.NewDiscovery(\r\n    discovery.WithRegistry(etcdRegistry),\r\n    discovery.WithBalancer(balancer.Random),\r\n)\r\nlb := discovery.NewLoadBalancer(discoveryClient, "user-service")\r\n\r\n// \u521b\u5efa\u6545\u969c\u8f6c\u79fb\u914d\u7f6e\r\nfailoverConfig := &failover.Config{\r\n    MaxAttempts: 3,\r\n    RetryInterval: time.Millisecond * 100,\r\n}\r\n\r\n// \u521d\u59cb\u5316\u4ee3\u7406\r\nvar userService UserService\r\nerr := rpc.InitProxy(\r\n    "localhost:8000", \r\n    &userService,\r\n    rpc.WithLoadBalancer(lb),\r\n    rpc.WithProxyFailover(failoverConfig),\r\n    rpc.WithServiceName("UserService"),\r\n)\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u4ee3\u7406\u5de5\u4f5c\u539f\u7406",children:"\u4ee3\u7406\u5de5\u4f5c\u539f\u7406"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"InitProxy"}),"\u901a\u8fc7\u53cd\u5c04\u5206\u6790\u670d\u52a1\u63a5\u53e3\u7ed3\u6784"]}),"\n",(0,l.jsx)(n.li,{children:"\u5bf9\u4e8e\u6bcf\u4e2a\u51fd\u6570\u5b57\u6bb5\uff0c\u521b\u5efa\u4e00\u4e2a\u4ee3\u7406\u51fd\u6570\uff0c\u66ff\u6362\u539f\u59cb\u5b57\u6bb5"}),"\n",(0,l.jsxs)(n.li,{children:["\u4ee3\u7406\u51fd\u6570\u8d1f\u8d23\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5e8f\u5217\u5316\u8bf7\u6c42\u53c2\u6570"}),"\n",(0,l.jsx)(n.li,{children:"\u9009\u62e9\u5408\u9002\u7684\u670d\u52a1\u8282\u70b9\uff08\u5982\u542f\u7528\u8d1f\u8f7d\u5747\u8861\uff09"}),"\n",(0,l.jsx)(n.li,{children:"\u53d1\u9001RPC\u8bf7\u6c42"}),"\n",(0,l.jsx)(n.li,{children:"\u5904\u7406\u6545\u969c\u8f6c\u79fb\uff08\u5982\u914d\u7f6e\uff09"}),"\n",(0,l.jsx)(n.li,{children:"\u53cd\u5e8f\u5217\u5316\u54cd\u5e94"}),"\n",(0,l.jsx)(n.li,{children:"\u8fd4\u56de\u7ed3\u679c\u6216\u9519\u8bef"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u793a\u4f8b\u4ee3\u7801",children:"\u793a\u4f8b\u4ee3\u7801"}),"\n",(0,l.jsx)(n.h3,{id:"api\u5ba2\u6237\u7aef\u793a\u4f8b",children:"API\u5ba2\u6237\u7aef\u793a\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'package main\r\n\r\nimport (\r\n    "context"\r\n    "fmt"\r\n    "log"\r\n    "time"\r\n\r\n    "github.com/fyerfyer/fyer-rpc/api"\r\n    "github.com/fyerfyer/fyer-rpc/protocol"\r\n)\r\n\r\n// \u8bf7\u6c42\u548c\u54cd\u5e94\u7ed3\u6784\u4f53\r\ntype HelloRequest struct {\r\n    Name string `json:"name"`\r\n}\r\n\r\ntype HelloResponse struct {\r\n    Message string `json:"message"`\r\n}\r\n\r\nfunc main() {\r\n    // \u521b\u5efa\u5ba2\u6237\u7aef\r\n    options := &api.ClientOptions{\r\n        Address:       "localhost:8000",\r\n        Timeout:       time.Second * 5,\r\n        SerializeType: protocol.SerializationTypeJSON,\r\n    }\r\n\r\n    client, err := api.NewClient(options)\r\n    if err != nil {\r\n        log.Fatalf("Failed to create client: %v", err)\r\n    }\r\n    defer client.Close()\r\n\r\n    // \u521b\u5efa\u8bf7\u6c42\r\n    request := &HelloRequest{Name: "World"}\r\n    response := &HelloResponse{}\r\n\r\n    // \u8c03\u7528\u8fdc\u7a0b\u670d\u52a1\r\n    ctx := context.Background()\r\n    err = client.Call(ctx, "GreeterService", "SayHello", request, response)\r\n    if err != nil {\r\n        log.Fatalf("RPC call failed: %v", err)\r\n    }\r\n\r\n    fmt.Printf("Response: %s\\n", response.Message)\r\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u4ee3\u7406\u8c03\u7528\u793a\u4f8b",children:"\u4ee3\u7406\u8c03\u7528\u793a\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'package main\r\n\r\nimport (\r\n    "context"\r\n    "fmt"\r\n    "log"\r\n\r\n    "github.com/fyerfyer/fyer-rpc/rpc"\r\n)\r\n\r\n// \u670d\u52a1\u63a5\u53e3\r\ntype GreeterService struct {\r\n    SayHello func(ctx context.Context, req *HelloRequest) (*HelloResponse, error)\r\n}\r\n\r\n// \u8bf7\u6c42\u548c\u54cd\u5e94\u7ed3\u6784\u4f53\r\ntype HelloRequest struct {\r\n    Name string `json:"name"`\r\n}\r\n\r\ntype HelloResponse struct {\r\n    Message string `json:"message"`\r\n}\r\n\r\nfunc main() {\r\n    // \u521b\u5efa\u4ee3\u7406\r\n    var greeter GreeterService\r\n    err := rpc.InitProxy("localhost:8000", &greeter)\r\n    if err != nil {\r\n        log.Fatalf("Failed to create proxy: %v", err)\r\n    }\r\n\r\n    // \u8c03\u7528\u8fdc\u7a0b\u65b9\u6cd5\r\n    ctx := context.Background()\r\n    resp, err := greeter.SayHello(ctx, &HelloRequest{Name: "World"})\r\n    if err != nil {\r\n        log.Fatalf("RPC call failed: %v", err)\r\n    }\r\n\r\n    fmt.Printf("Response: %s\\n", resp.Message)\r\n}\n'})})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>c});var i=r(6540);const l={},t=i.createContext(l);function o(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);