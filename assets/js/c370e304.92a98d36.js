"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[108],{1630:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"api-reference/cluster_package","title":"cluster Package","description":"cluster\u5305\u63d0\u4f9b\u4e86\u96c6\u7fa4\u7ba1\u7406\u529f\u80fd\uff0c\u5305\u62ec\u5206\u7ec4\u8def\u7531\u3001\u6545\u969c\u8f6c\u79fb\u548c\u670d\u52a1\u9009\u62e9\u3002","source":"@site/docs/api-reference/cluster_package.md","sourceDirName":"api-reference","slug":"/api-reference/cluster_package","permalink":"/fyer-rpc/docs/api-reference/cluster_package","draft":false,"unlisted":false,"editUrl":"https://github.com/fyerfyer/fyer-rpc/tree/main/docs/api-reference/cluster_package.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"api Package","permalink":"/fyer-rpc/docs/api-reference/api-package"},"next":{"title":"discovery Package","permalink":"/fyer-rpc/docs/api-reference/discovery-package"}}');var c=r(4848),a=r(8453);const o={},s="cluster Package",i={},l=[{value:"failover \u5b50\u5305",id:"failover-\u5b50\u5305",level:3},{value:"selector \u5b50\u5305",id:"selector-\u5b50\u5305",level:3},{value:"group \u5b50\u5305",id:"group-\u5b50\u5305",level:3}];function u(e){const n={code:"code",h1:"h1",h3:"h3",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsxs)(n.h1,{id:"cluster-package",children:[(0,c.jsx)(n.code,{children:"cluster"})," Package"]})}),"\n",(0,c.jsx)(n.p,{children:"cluster\u5305\u63d0\u4f9b\u4e86\u96c6\u7fa4\u7ba1\u7406\u529f\u80fd\uff0c\u5305\u62ec\u5206\u7ec4\u8def\u7531\u3001\u6545\u969c\u8f6c\u79fb\u548c\u670d\u52a1\u9009\u62e9\u3002"}),"\n",(0,c.jsx)(n.h3,{id:"failover-\u5b50\u5305",children:"failover \u5b50\u5305"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"failover"}),"\u5b50\u5305\u5b9e\u73b0\u4e86\u6545\u969c\u8f6c\u79fb\u529f\u80fd\uff1a"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:"// DefaultFailoverHandler \u9ed8\u8ba4\u6545\u969c\u8f6c\u79fb\u5904\u7406\u5668\r\ntype DefaultFailoverHandler struct {\r\n    detector        Detector\r\n    circuitBreaker  CircuitBreaker\r\n    retryPolicy     RetryPolicy\r\n    recovery        RecoveryStrategy\r\n    monitor         InstanceMonitor\r\n}\r\n\r\n// NewFailoverHandler \u521b\u5efa\u6545\u969c\u8f6c\u79fb\u5904\u7406\u5668\r\nfunc NewFailoverHandler(config *Config) (*DefaultFailoverHandler, error)\r\n\r\n// Execute \u6267\u884c\u5e26\u6545\u969c\u8f6c\u79fb\u7684\u8c03\u7528\r\nfunc (h *DefaultFailoverHandler) Execute(ctx context.Context, instances []*naming.Instance, operation func(context.Context, *naming.Instance) error) (*FailoverResult, error)\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u6545\u969c\u68c0\u6d4b\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:"type Detector interface {\r\n    // Detect \u68c0\u6d4b\u5b9e\u4f8b\u662f\u5426\u5065\u5eb7\r\n    Detect(ctx context.Context, instance *naming.Instance) (Status, error)\r\n\r\n    // MarkFailed \u6807\u8bb0\u5b9e\u4f8b\u4e3a\u5931\u8d25\u72b6\u6001\r\n    MarkFailed(ctx context.Context, instance *naming.Instance) error\r\n\r\n    // MarkSuccess \u6807\u8bb0\u5b9e\u4f8b\u4e3a\u6210\u529f\u72b6\u6001\r\n    MarkSuccess(ctx context.Context, instance *naming.Instance) error\r\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u7194\u65ad\u5668\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:"type CircuitBreaker interface {\r\n    // Allow \u5224\u65ad\u8bf7\u6c42\u662f\u5426\u5141\u8bb8\u901a\u8fc7\r\n    Allow(ctx context.Context, instance *naming.Instance) (bool, error)\r\n\r\n    // MarkSuccess \u6807\u8bb0\u6210\u529f\u8c03\u7528\r\n    MarkSuccess(ctx context.Context, instance *naming.Instance) error\r\n\r\n    // MarkFailure \u6807\u8bb0\u5931\u8d25\u8c03\u7528\r\n    MarkFailure(ctx context.Context, instance *naming.Instance, err error) error\r\n\r\n    // GetState \u83b7\u53d6\u7194\u65ad\u5668\u72b6\u6001\r\n    GetState(instance *naming.Instance) (State, error)\r\n\r\n    // Reset \u91cd\u7f6e\u7194\u65ad\u5668\u72b6\u6001\r\n    Reset(instance *naming.Instance) error\r\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u91cd\u8bd5\u7b56\u7565\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:"type RetryPolicy interface {\r\n    // ShouldRetry \u51b3\u5b9a\u662f\u5426\u9700\u8981\u91cd\u8bd5\r\n    ShouldRetry(ctx context.Context, attempt int, err error) bool\r\n\r\n    // NextBackoff \u8ba1\u7b97\u4e0b\u4e00\u6b21\u91cd\u8bd5\u7684\u7b49\u5f85\u65f6\u95f4\r\n    NextBackoff(attempt int) time.Duration\r\n\r\n    // MaxAttempts \u8fd4\u56de\u6700\u5927\u91cd\u8bd5\u6b21\u6570\r\n    MaxAttempts() int\r\n}\n"})}),"\n",(0,c.jsx)(n.h3,{id:"selector-\u5b50\u5305",children:"selector \u5b50\u5305"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"selector"}),"\u5b50\u5305\u5b9e\u73b0\u4e86\u670d\u52a1\u9009\u62e9\u529f\u80fd\uff1a"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:"// Selector \u5b9a\u4e49\u4e86\u9009\u62e9\u5668\u63a5\u53e3\r\ntype Selector interface {\r\n    // Select \u4ece\u670d\u52a1\u5b9e\u4f8b\u5217\u8868\u4e2d\u9009\u62e9\u7b26\u5408\u6761\u4ef6\u7684\u5b9e\u4f8b\r\n    Select(ctx context.Context, instances []*naming.Instance) ([]*naming.Instance, error)\r\n    \r\n    // Name \u8fd4\u56de\u9009\u62e9\u5668\u540d\u79f0\r\n    Name() string\r\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u9009\u62e9\u5668\u94fe\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:"// Chain \u9009\u62e9\u5668\u94fe\uff0c\u652f\u6301\u591a\u4e2a\u9009\u62e9\u5668\u4e32\u8054\r\ntype Chain struct {\r\n    selectors []Selector\r\n    name      string\r\n}\r\n\r\n// NewChain \u521b\u5efa\u65b0\u7684\u9009\u62e9\u5668\u94fe\r\nfunc NewChain(name string, selectors ...Selector) *Chain\r\n\r\n// Select \u6309\u987a\u5e8f\u6267\u884c\u9009\u62e9\u5668\u94fe\u4e2d\u7684\u6240\u6709\u9009\u62e9\u5668\r\nfunc (c *Chain) Select(ctx context.Context, instances []*naming.Instance) ([]*naming.Instance, error)\n"})}),"\n",(0,c.jsx)(n.h3,{id:"group-\u5b50\u5305",children:"group \u5b50\u5305"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"group"}),"\u5b50\u5305\u5b9e\u73b0\u4e86\u670d\u52a1\u5206\u7ec4\u529f\u80fd\uff1a"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:"// Group \u8868\u793a\u4e00\u4e2a\u670d\u52a1\u5206\u7ec4\u7684\u63a5\u53e3\r\ntype Group interface {\r\n    // Name \u8fd4\u56de\u5206\u7ec4\u540d\u79f0\r\n    Name() string\r\n\r\n    // Match \u68c0\u67e5\u5b9e\u4f8b\u662f\u5426\u5339\u914d\u8be5\u5206\u7ec4\r\n    Match(instance *naming.Instance) bool\r\n\r\n    // Select \u4ece\u5b9e\u4f8b\u5217\u8868\u4e2d\u9009\u62e9\u5339\u914d\u8be5\u5206\u7ec4\u7684\u5b9e\u4f8b\r\n    Select(ctx context.Context, instances []*naming.Instance) ([]*naming.Instance, error)\r\n}\r\n\r\n// NewGroup \u521b\u5efa\u65b0\u7684\u5206\u7ec4\r\nfunc NewGroup(name string, opts ...Option) (*DefaultGroup, error)\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u5206\u7ec4\u8def\u7531\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:"// GroupRouter \u5206\u7ec4\u8def\u7531\u63a5\u53e3\r\ntype GroupRouter interface {\r\n    // Route \u6839\u636e\u4e0a\u4e0b\u6587\u8def\u7531\u5230\u6307\u5b9a\u5206\u7ec4\r\n    Route(ctx context.Context, instances []*naming.Instance) ([]*naming.Instance, error)\r\n}\r\n\r\n// NewRouter \u521b\u5efa\u65b0\u7684\u8def\u7531\u5668\r\nfunc NewRouter(manager GroupManager) *DefaultRouter\r\n\r\n// NewRouterChain \u521b\u5efa\u65b0\u7684\u8def\u7531\u94fe\r\nfunc NewRouterChain(routers ...GroupRouter) *RouterChain\n"})})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(u,{...e})}):u(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>s});var t=r(6540);const c={},a=t.createContext(c);function o(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);