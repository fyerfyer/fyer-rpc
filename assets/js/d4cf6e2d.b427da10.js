"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[333],{2971:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>s,default:()=>p,frontMatter:()=>t,metadata:()=>a,toc:()=>i});const a=JSON.parse('{"id":"api-reference/protocol-package","title":"Protocol Package","description":"protocol\u5305\u5b9a\u4e49\u4e86 RPC \u901a\u4fe1\u534f\u8bae\uff0c\u5305\u62ec\u6d88\u606f\u683c\u5f0f\u3001\u5e8f\u5217\u5316\u548c\u7f16\u89e3\u7801\u3002","source":"@site/docs/api-reference/protocol-package.md","sourceDirName":"api-reference","slug":"/api-reference/protocol-package","permalink":"/fyer-rpc/docs/api-reference/protocol-package","draft":false,"unlisted":false,"editUrl":"https://github.com/fyerfyer/fyer-rpc/tree/main/docs/api-reference/protocol-package.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"discovery Package","permalink":"/fyer-rpc/docs/api-reference/discovery-package"},"next":{"title":"registry Package","permalink":"/fyer-rpc/docs/api-reference/registry-package"}}');var c=n(4848),o=n(8453);const t={},s="Protocol Package",d={},i=[{value:"Message",id:"message",level:3},{value:"Header",id:"header",level:3},{value:"Metadata",id:"metadata",level:3},{value:"Protocol",id:"protocol",level:3},{value:"Codec",id:"codec",level:3}];function l(e){const r={code:"code",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(r.header,{children:(0,c.jsx)(r.h1,{id:"protocol-package",children:"Protocol Package"})}),"\n",(0,c.jsx)(r.p,{children:"protocol\u5305\u5b9a\u4e49\u4e86 RPC \u901a\u4fe1\u534f\u8bae\uff0c\u5305\u62ec\u6d88\u606f\u683c\u5f0f\u3001\u5e8f\u5217\u5316\u548c\u7f16\u89e3\u7801\u3002"}),"\n",(0,c.jsx)(r.h3,{id:"message",children:"Message"}),"\n",(0,c.jsxs)(r.p,{children:[(0,c.jsx)(r.code,{children:"Message"}),"\u7ed3\u6784\u4f53\u5b9a\u4e49\u4e86 RPC \u6d88\u606f\u7684\u683c\u5f0f\uff1a"]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-go",children:"type Message struct {\r\n    Header   Header    // \u6d88\u606f\u5934\u90e8\r\n    Metadata *Metadata // \u5143\u6570\u636e\r\n    Payload  []byte    // \u6d88\u606f\u4f53\r\n}\n"})}),"\n",(0,c.jsx)(r.h3,{id:"header",children:"Header"}),"\n",(0,c.jsxs)(r.p,{children:[(0,c.jsx)(r.code,{children:"Header"}),"\u7ed3\u6784\u4f53\u5b9a\u4e49\u4e86\u6d88\u606f\u5934\u90e8\uff1a"]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-go",children:"type Header struct {\r\n    MagicNumber       uint16 // \u9b54\u6570\uff0c\u7528\u4e8e\u6821\u9a8c\u62a5\u6587\r\n    Version           uint8  // \u534f\u8bae\u7248\u672c\u53f7\r\n    MessageType       uint8  // \u6d88\u606f\u7c7b\u578b(\u8bf7\u6c42/\u54cd\u5e94)\r\n    CompressType      uint8  // \u538b\u7f29\u7c7b\u578b\r\n    SerializationType uint8  // \u5e8f\u5217\u5316\u7c7b\u578b\r\n    MessageID         uint64 // \u6d88\u606fID\uff0c\u7528\u4e8e\u591a\u8def\u590d\u7528\r\n    MetadataSize      uint32 // \u5143\u6570\u636e\u957f\u5ea6\r\n    PayloadSize       uint32 // \u6d88\u606f\u4f53\u957f\u5ea6\r\n}\n"})}),"\n",(0,c.jsx)(r.h3,{id:"metadata",children:"Metadata"}),"\n",(0,c.jsxs)(r.p,{children:[(0,c.jsx)(r.code,{children:"Metadata"}),"\u7ed3\u6784\u4f53\u5305\u542b RPC \u8c03\u7528\u7684\u5143\u6570\u636e\uff1a"]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-go",children:"type Metadata struct {\r\n    ServiceName string            // \u670d\u52a1\u540d\u79f0\r\n    MethodName  string            // \u65b9\u6cd5\u540d\u79f0\r\n    Error       string            // \u9519\u8bef\u4fe1\u606f(\u4ec5\u54cd\u5e94\u6d88\u606f\u4f7f\u7528)\r\n    Extra       map[string]string // \u989d\u5916\u7684\u5143\u6570\u636e\uff0c\u5982trace_id\u7b49\r\n}\n"})}),"\n",(0,c.jsx)(r.h3,{id:"protocol",children:"Protocol"}),"\n",(0,c.jsx)(r.p,{children:"Protocol\u63a5\u53e3\u5b9a\u4e49\u4e86\u6d88\u606f\u7684\u7f16\u7801\u548c\u89e3\u7801\u65b9\u6cd5\uff1a"}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-go",children:"type Protocol interface {\r\n    EncodeMessage(message *Message, writer io.Writer) error\r\n    DecodeMessage(reader io.Reader) (*Message, error)\r\n}\n"})}),"\n",(0,c.jsx)(r.h3,{id:"codec",children:"Codec"}),"\n",(0,c.jsxs)(r.p,{children:[(0,c.jsx)(r.code,{children:"codec"}),"\u5b50\u5305\u63d0\u4f9b\u4e86\u4e0d\u540c\u7684\u5e8f\u5217\u5316\u5b9e\u73b0\uff1a"]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-go",children:"type Codec interface {\r\n    // Encode \u5c06\u5bf9\u8c61\u5e8f\u5217\u5316\u4e3a\u5b57\u8282\u6570\u7ec4\r\n    Encode(v interface{}) ([]byte, error)\r\n\r\n    // Decode \u5c06\u5b57\u8282\u6570\u7ec4\u53cd\u5e8f\u5217\u5316\u4e3a\u5bf9\u8c61\r\n    Decode(data []byte, v interface{}) error\r\n\r\n    // Name \u8fd4\u56de\u7f16\u89e3\u7801\u5668\u7684\u540d\u79f0\r\n    Name() string\r\n}\n"})}),"\n",(0,c.jsx)(r.p,{children:"\u5185\u7f6e\u5b9e\u73b0\u5305\u62ec\uff1a"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"JsonCodec"}),": JSON \u5e8f\u5217\u5316"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"ProtobufCodec"}),": Protobuf \u5e8f\u5217\u5316"]}),"\n"]})]})}function p(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,c.jsx)(r,{...e,children:(0,c.jsx)(l,{...e})}):l(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>t,x:()=>s});var a=n(6540);const c={},o=a.createContext(c);function t(e){const r=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:t(e.components),a.createElement(o.Provider,{value:r},e.children)}}}]);