"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[392],{8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>i});var c=n(6540);const s={},t=c.createContext(s);function a(e){const r=c.useContext(t);return c.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),c.createElement(t.Provider,{value:r},e.children)}},9728:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>c,toc:()=>l});const c=JSON.parse('{"id":"api-reference/discovery-package","title":"discovery Package","description":"discovery\u5305\u63d0\u4f9b\u4e86\u670d\u52a1\u53d1\u73b0\u529f\u80fd\uff0c\u652f\u6301\u52a8\u6001\u67e5\u627e\u548c\u76d1\u63a7\u670d\u52a1\u5b9e\u4f8b\u3002","source":"@site/docs/api-reference/discovery-package.md","sourceDirName":"api-reference","slug":"/api-reference/discovery-package","permalink":"/fyer-rpc/docs/api-reference/discovery-package","draft":false,"unlisted":false,"editUrl":"https://github.com/fyerfyer/fyer-rpc/tree/main/docs/api-reference/discovery-package.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"cluster Package","permalink":"/fyer-rpc/docs/api-reference/cluster_package"},"next":{"title":"Protocol Package","permalink":"/fyer-rpc/docs/api-reference/protocol-package"}}');var s=n(4848),t=n(8453);const a={},i="discovery Package",o={},l=[{value:"Discovery",id:"discovery",level:3},{value:"Watcher",id:"watcher",level:3},{value:"Resolver",id:"resolver",level:3},{value:"LoadBalancer",id:"loadbalancer",level:3},{value:"balancer \u5b50\u5305",id:"balancer-\u5b50\u5305",level:3},{value:"metrics \u5b50\u5305",id:"metrics-\u5b50\u5305",level:3}];function d(e){const r={code:"code",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsxs)(r.h1,{id:"discovery-package",children:[(0,s.jsx)(r.code,{children:"discovery"})," Package"]})}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"discovery"}),"\u5305\u63d0\u4f9b\u4e86\u670d\u52a1\u53d1\u73b0\u529f\u80fd\uff0c\u652f\u6301\u52a8\u6001\u67e5\u627e\u548c\u76d1\u63a7\u670d\u52a1\u5b9e\u4f8b\u3002"]}),"\n",(0,s.jsx)(r.h3,{id:"discovery",children:"Discovery"}),"\n",(0,s.jsx)(r.p,{children:"Discovery\u63a5\u53e3\u5b9a\u4e49\u4e86\u670d\u52a1\u53d1\u73b0\u7684\u6838\u5fc3\u529f\u80fd\uff1a"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-go",children:"type Discovery interface {\r\n    // GetService \u83b7\u53d6\u670d\u52a1\u5b9e\u4f8b\r\n    GetService(ctx context.Context, name string, version string) ([]*naming.Instance, error)\r\n\r\n    // Watch \u76d1\u542c\u670d\u52a1\u53d8\u66f4\r\n    Watch(ctx context.Context, name string, version string) (Watcher, error)\r\n\r\n    // Close \u5173\u95ed\u670d\u52a1\u53d1\u73b0\r\n    Close() error\r\n}\n"})}),"\n",(0,s.jsx)(r.h3,{id:"watcher",children:"Watcher"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"Watcher"}),"\u63a5\u53e3\u7528\u4e8e\u76d1\u542c\u670d\u52a1\u5b9e\u4f8b\u7684\u53d8\u5316\uff1a"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-go",children:"type Watcher interface {\r\n    // Next \u83b7\u53d6\u4e0b\u4e00\u6b21\u670d\u52a1\u66f4\u65b0\r\n    Next() ([]*naming.Instance, error)\r\n\r\n    // Stop \u505c\u6b62\u76d1\u542c\r\n    Stop() error\r\n}\n"})}),"\n",(0,s.jsx)(r.h3,{id:"resolver",children:"Resolver"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"Resolver"}),"\u7ed3\u6784\u4f53\u5b9e\u73b0\u4e86\u670d\u52a1\u89e3\u6790\u5668\uff1a"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-go",children:"type Resolver struct {\r\n    registry  registry.Registry\r\n    service   string\r\n    version   string\r\n    instances []*naming.Instance\r\n    watcher   <-chan []*naming.Instance\r\n}\r\n\r\n// NewResolver \u521b\u5efa\u670d\u52a1\u89e3\u6790\u5668\r\nfunc NewResolver(reg registry.Registry, service, version string, opts ...ResolverOption) (*Resolver, error)\r\n\r\n// Resolve \u89e3\u6790\u670d\u52a1\u5730\u5740\r\nfunc (r *Resolver) Resolve() ([]*naming.Instance, error)\n"})}),"\n",(0,s.jsx)(r.h3,{id:"loadbalancer",children:"LoadBalancer"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"LoadBalancer"}),"\u7ed3\u6784\u4f53\u5b9e\u73b0\u4e86\u5ba2\u6237\u7aef\u8d1f\u8f7d\u5747\u8861\uff1a"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-go",children:"type LoadBalancer struct {\r\n    resolver       *Resolver\r\n    balancer       balancer.Balancer\r\n    failover       *failover.DefaultFailoverHandler\r\n    metrics        metrics.Metrics\r\n    serviceName    string\r\n    version        string\r\n}\r\n\r\n// NewLoadBalancer \u521b\u5efa\u8d1f\u8f7d\u5747\u8861\u5668\r\nfunc NewLoadBalancer(serviceName, version string, resolver *Resolver, metrics metrics.Metrics, balancerType balancer.BalancerType, options ...LoadBalancerOption) (*LoadBalancer, error)\r\n\r\n// Select \u9009\u62e9\u4e00\u4e2a\u670d\u52a1\u5b9e\u4f8b\r\nfunc (lb *LoadBalancer) Select(ctx context.Context) (*naming.Instance, error)\n"})}),"\n",(0,s.jsx)(r.h3,{id:"balancer-\u5b50\u5305",children:"balancer \u5b50\u5305"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"balancer"}),"\u5b50\u5305\u63d0\u4f9b\u4e86\u4e0d\u540c\u7684\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\uff1a"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-go",children:"type Balancer interface {\r\n    // Initialize \u521d\u59cb\u5316\u8d1f\u8f7d\u5747\u8861\u5668\r\n    Initialize(instances []*naming.Instance) error\r\n\r\n    // Select \u9009\u62e9\u4e00\u4e2a\u670d\u52a1\u5b9e\u4f8b\r\n    Select(ctx context.Context) (*naming.Instance, error)\r\n\r\n    // Update \u66f4\u65b0\u670d\u52a1\u5b9e\u4f8b\u5217\u8868\r\n    Update(instances []*naming.Instance) error\r\n\r\n    // Feedback \u670d\u52a1\u8c03\u7528\u7ed3\u679c\u53cd\u9988\r\n    Feedback(ctx context.Context, instance *naming.Instance, duration int64, err error)\r\n\r\n    // Name \u8fd4\u56de\u8d1f\u8f7d\u5747\u8861\u5668\u540d\u79f0\r\n    Name() string\r\n}\n"})}),"\n",(0,s.jsx)(r.p,{children:"\u5185\u7f6e\u7b56\u7565\uff1a"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"Random"}),": \u968f\u673a\u9009\u62e9"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"RoundRobin"}),": \u8f6e\u8be2\u9009\u62e9"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"FastestResponse"}),": \u6700\u5feb\u54cd\u5e94\u65f6\u95f4"]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"metrics-\u5b50\u5305",children:"metrics \u5b50\u5305"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"metrics"}),"\u5b50\u5305\u63d0\u4f9b\u4e86\u6027\u80fd\u6307\u6807\u6536\u96c6\u529f\u80fd\uff1a"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-go",children:"type Metrics interface {\r\n    // RecordResponse \u8bb0\u5f55\u54cd\u5e94\u65f6\u95f4\r\n    RecordResponse(ctx context.Context, metric *ResponseMetric) error\r\n\r\n    // GetLatency \u83b7\u53d6\u6307\u5b9a\u670d\u52a1\u5b9e\u4f8b\u7684\u5e73\u5747\u54cd\u5e94\u65f6\u95f4\r\n    GetLatency(ctx context.Context, service, instance string) (time.Duration, error)\r\n\r\n    // GetServiceLatency \u83b7\u53d6\u670d\u52a1\u6240\u6709\u5b9e\u4f8b\u7684\u5e73\u5747\u54cd\u5e94\u65f6\u95f4\r\n    GetServiceLatency(ctx context.Context, service string) (map[string]time.Duration, error)\r\n\r\n    // \u5176\u5b83\u65b9\u6cd5...\r\n}\n"})})]})}function p(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);